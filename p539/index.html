<!DOCTYPE html>
<html lang="en-gb">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">

<meta itemprop="name" content="#27: GSoC with KDE Now – 5">
<meta itemprop="description" content="Hey ! I&#8217;m making KDE Now, an application for the Plasma Desktop. It would help the user see important stuff from his email, on a plasmoid. It&#8217;s similar to what Google Now does on Android. To know more, click here
&nbsp;
I know, I know. I haven&#8217;t blogged for a while. But the past couple of weeks have been busy. Not just in terms of my project, but also my personal life, with a lot of things happening lately that demand my attention.">


<meta itemprop="datePublished" content="2016-07-02T08:46:46&#43;00:00" />
<meta itemprop="dateModified" content="2016-07-02T08:46:46&#43;00:00" />
<meta itemprop="wordCount" content="907">



<meta itemprop="keywords" content="gsoc16,kde," />
<meta property="og:title" content="#27: GSoC with KDE Now – 5" />
<meta property="og:description" content="Hey ! I&#8217;m making KDE Now, an application for the Plasma Desktop. It would help the user see important stuff from his email, on a plasmoid. It&#8217;s similar to what Google Now does on Android. To know more, click here
&nbsp;
I know, I know. I haven&#8217;t blogged for a while. But the past couple of weeks have been busy. Not just in terms of my project, but also my personal life, with a lot of things happening lately that demand my attention." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aditya-dev.xyz/p539/" />
<meta property="article:published_time" content="2016-07-02T08:46:46&#43;00:00"/>
<meta property="article:modified_time" content="2016-07-02T08:46:46&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="#27: GSoC with KDE Now – 5"/>
<meta name="twitter:description" content="Hey ! I&#8217;m making KDE Now, an application for the Plasma Desktop. It would help the user see important stuff from his email, on a plasmoid. It&#8217;s similar to what Google Now does on Android. To know more, click here
&nbsp;
I know, I know. I haven&#8217;t blogged for a while. But the past couple of weeks have been busy. Not just in terms of my project, but also my personal life, with a lot of things happening lately that demand my attention."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>#27: GSoC with KDE Now – 5</title>
	<link rel="stylesheet" href="https://aditya-dev.xyz/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://aditya-dev.xyz">Aditya Sharma</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://aditya-dev.xyz/posts/">Posts</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://github.com/g33kyaditya" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://www.linkedin.com/in/aditya-sharma-7b65a010b" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="mailto:g33kyaditya@gmail.com" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a><a href="https://drive.google.com/file/d/0B2UcOgLtxPKeRGZBX2xnMkp0NFE/view" target="_blank" rel="noopener me" title="Cv"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 1024 1024" fill="currentColor" stroke="currentColor" stroke-width="30" stroke-linecap="round" stroke-linejoin="round" class="feather feather-cv"><path d="M809.4 64.2H214.6c-45.9 0-83.3 37.4-83.3 83.3v729c0 45.9 37.4 83.3 83.3 83.3h470c6.9 0 13.5-2.8 18.3-7.7l182.2-184.6c4.8-4.8 7.4-11.3 7.4-18.1V147.5c0.1-45.9-37.2-83.3-83.1-83.3zM703.9 886v-78.2c0-21.3 17.4-38.6 38.7-38.6h76.9L703.9 886z m142.3-159.1H745.7c-46.6 0-84.5 37.9-84.5 84.5v103h-451c-17.8 0-32.3-14.5-32.3-32.3V142c0-17.8 14.5-32.3 32.3-32.3h603.7c17.8 0 32.3 14.5 32.3 32.3v584.9zM689 640H335c-12.6 0-23-10.3-23-23 0-12.6 10.3-23 23-23h354c12.7 0 23 10.4 23 23s-10.3 23-23 23zM489 749.9H335c-12.6 0-23-10.4-23-23s10.3-23 23-23h154c12.6 0 23 10.3 23 23 0 12.6-10.3 23-23 23zM583.5 354.7c15.8-17.3 25.5-40.3 25.5-65.6 0-53.6-43.4-97-97-97s-97 43.4-97 97c0 25.3 9.7 48.3 25.5 65.6C375 382.5 329 447.5 329 523.2c0 12.7 10.3 23 23 23s23-10.3 23-23c0-75.7 61.3-137 137-137s137 61.3 137 137c0 12.7 10.3 23 23 23s23-10.3 23-23c0-75.7-46-140.7-111.5-168.5zM512 238.2c28.2 0 51 22.8 51 51s-22.8 51-51 51-51-22.8-51-51 22.8-51 51-51z" /></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://aditya-dev.xyz/posts/">Posts</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>#27: GSoC with KDE Now – 5</h1>
		<div class="content">
			<p>Hey ! I&#8217;m making KDE Now, an application for the Plasma Desktop. It would help the user see important stuff from his email, on a plasmoid. It&#8217;s similar to what Google Now does on Android. To know more, click <a href="https://g33kyaditya.wordpress.com/2016/04/23/21-google-summer-of-code-2016/">here</a></p>

<p>&nbsp;</p>

<p>I know, I know. I haven&#8217;t blogged for a while. But the past couple of weeks have been busy. Not just in terms of my project, but also my personal life, with a lot of things happening lately that demand my attention. Thankfully, I have been able to commit proper time to my project.</p>

<p>This time, there&#8217;s a lot to talk about.</p>

<p>I implemented all the extractors as run time plugins this time around. Earlier the daemon was not independent of it, with the extractors implemented as part of processor itself. Now, thanks to plugin architecture they are independent, and the daemon loads the plugins at run time. This was also part of my Season of KDE project for Plasma Media Center last year. It was only a lot more fun this time around, since I was starting from scratch. The advantage of having this architecture is the ease with which you can add support for plugins/extractors in future. At the end of this post, I&#8217;ll describe roughly how you can do this.</p>

<p>Next up, I added support for database. It was always a plan to cache stuff, to avoid unnecessary network usage. But we had not decided on the exact details of this implementation. I wasn&#8217;t sure whether to cache on files or use a database. I went to IRC and asked around. Bhushan (bshah) suggested to use a database since that adds security. Trojita, which is  a Qt based IMAP client also uses a database for this. Hence, I planned to use a database altogether. My mentor suggested something along the lines of MongoDB in which I can save the whole data map and would not have to manually map everything (cheers !). My data was JSON so things would be a cakewalk. Both saving as well as retrieving data. Unfortunately, Qt doesn&#8217;t provide support for it. I looked for some C++ drivers around, but couldn&#8217;t find anything useful. In the end we settled for SQLite since it&#8217;s lightweight, supported by Qt and generally has compiled drivers for most distributions.</p>

<p>Next, I exposed data from these plugins to D-Bus. I must say, I enjoyed learning about D-Bus. I had read about it earlier, during community bonding stage. But I forgot most of it, with all the things going on during my semester exams. Lol :D. Hence, when I read about D-Bus now, it was as good as a fresh start. I wrote small test programs too, for trying out QDBus. I came across a rather nasty problem related to D-Bus however. I was registering the proper service and object, but on calling the method, I repeatedly got the error of D-Bus Unknown object. After many hours, I consulted my mentor. He guessed it might be because, the object was getting destroyed on leaving scope (since it was in stack memory). His guess was spot on. I changed the object to heap memory and it worked like a charm ! We later decided to completely remove the extra interface files I had made, and currently we expose data from the plugin itself.</p>

<p><img class="alignnone size-full wp-image-544" src="https://g33kyaditya.files.wordpress.com/2016/07/1.png" alt="1" width="1366" height="742" /></p>

<p>As I promised earlier (did I ?), here&#8217;s how you can add plugins now.</p>

<ul>
<li>Get into the reservations directory and create a directory for your plugin</li>
<li>Include the directory, in reservations/CMakeLists.txt</li>
<li>In yourPluginDirectory, you need to make four files: yourPlugin.desktop to describe the plugin, yourPlugin.h, yourPlugin.cpp and CMakeLists.txt files</li>
<li>Make sure that yourPlugin inherits publicly from AbstractReservationPlugin, and make sure to define the start() method in yourPlugin. (I have made it virtual in AbstactReservationPlugin, hence you must implement it).</li>
<li>Do whatever you need in your plugin.</li>
<li>Describe your plugin in a yourPlugin.desktop file, and make sure you set the ServiceTypes to KDENow/Plugin (*Hint* Look at the ones already made and make relevant changes )</li>
<li>You need to store stuff to Database. Cache what you extracted.</li>
<li>Expose your data map to D-Bus. For this, yourPlugin.h must have this macro: Q_CLASSINFO(&#8220;D-Bus Interface&#8221;, &#8220;org.kde.kdenow.<yourPlugin>&#8221;)</li>
<li>In yourPlugin.cpp, bind the D-Bus Adaptor, and register the object and service (Look at the ones I already have done)</li>
<li>Implement a public Q_SLOT for getting the data. It can be whatever, but preferably a QVariantMap. However, if it&#8217;s a custom data type that is not natively handled by Qt DBus then you need to implement the stream operator functions and pass data byte by byte. Look at the Qt D-Bus Type System docs, to see whether your data type is natively handled or not.</li>
<li>Make a CMakelists.txt describing the build specs. Make sure to call the qt5_generate_dbus_interface and qt5_add_dbus_adaptor and kcoreaddons_desktop_to_json methods with relevant arguments</li>
<li>Make sure to install all the things at the right place.</li>
<li>Or, you can just copy the CMakeLists.txt I made and make relevant changes 😉</li>
<li>Test with relevant data</li>
</ul>

<p>&nbsp;</p>

<p>With all of this, I think most of my backend work regarding emails and all has finished. For the next few things, I plan to write the receivers for the D-Bus data and do something to get data, when the daemon is not running, but the plasmoid is running (Hence, fetch from database). Also, after that I need to write User Interfaces for the plasmoid and cards.</p>

<p>Cheers !</p>

<p>I&#8217;ll catch you in the next one</p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://aditya-dev.xyz">Aditya Sharma</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://aditya-dev.xyz/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://aditya-dev.xyz/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
